{% extends "public/layout/layout.html" %}
{% block content %}
    {% csrf_token %}
    <div class="wrapper">
        <div class="container padding mainContent">
            <div class="container">
                <!-- CONTENT GOES HERE -->
                <div class="row gutters">
                    <div class="col span_6">
                        <h1>SESSIONS</h1>

                        <p><a href="{% url 'session-help' event_url=request.session.event_url %}"><i
                                class="fa fa-question-circle"></i> Session Help</a></p>
                        <h4>Knowledge levels:</h4>
                        <table>
                            <tbody>
                            <tr>
                                <td><strong>Beginners</strong></td>
                                <td>Kingsters who have little or no knowledge about the topic.</td>
                            </tr>
                            <tr>
                                <td><strong>Intermediate</strong></td>
                                <td>Kingsters who have a base knowledge or more experience on the topic.</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>


                    <div class="col span_6" style="text-align: right;">
                        <p></p><a href="{% url 'public-sessions' event_url=request.session.event_url %}"
                                  class="button round color2"><i
                            class="fa fa-list"></i>
                        List View</a></p>
                    </div>

                </div>
                <div class="row gutters">
                    <div class="col span_12">
                        <ul class="select">
                            <li class="all-session selected">All sessions</li>
                            <li class="my-session">My sessions</li>
                        </ul>
                    </div>
                </div>


                <div class="row gutters">
                    <div class="">
                        <div id='loading'>loading...</div>
                        <input type="hidden" id="start_date" value="{{ start_date }}"/>

                        <div id='calendar'></div>
                    </div>
                    <!--row-->
                    <!--row-->
                    <!--row-->
                </div>
            </div>
        </div>
    </div>
    <script>
        $(function () { // document ready
            var start_date = $('#start_date').val();
            var opt = {
                schedulerLicenseKey: '0659767746-fcs-1446193215',
                resourceAreaWidth: 500,
                {#                defaultDate: moment(start_date),#}
                defaultDate: "2015-11-20",
                slotDuration: '00:05:00',
                height: 600,
                slotWidth: 150,
                minTime: "08:00:00",
                maxTime: "24:00:00",
                header: {
                    left: 'prev,next',
                    center: 'title',
                    right: ''
                },
                buttonText: {
                    timelineDay: 'Grid view',
                    agendaTwoDays: 'Calendar view'
                },
                defaultView: 'agendaDay',
                {#                views: {#}
                {#                                        agendaDay: {#}
                {#                                           groupByResource: true#}
                {#                                        }#}
                {##}
                {#                },#}
                axisFormat: 'HH:mm',
                slotLabelFormat: "HH:mm",
                resourceLabelText: 'Session Group',

                resources: { // you can also specify a plain string like 'json/resources.json'
                    url: base_url + '/get-session-group/',
                    error: function () {
                        $('#script-warning').show();
                    }
                },

                events: { // you can also specify a plain string like 'json/events.json'
                    url: base_url + '/get-session-event/',
                    success: function () {
                        $(".fc-scrollpane div:first-child").scrollTop(0);
                    },
                    error: function () {
                        $('#script-warning').show();
                    },
                    complete: function () {
                        $(".fc-scrollpane div:first-child").scrollTop(0);
                    }
                },
                eventClick: function (calEvent, jsEvent, view) {

                    {#                    window.location = base_url + "/sessions/" + calEvent.id;#}
                    if (window.location.hostname != 'eventdobby.com') {
                        console.log(view)
                    }

                },
                eventRender: function (event, element) {
                    element.find(".fc-event-title").remove();
                    element.find(".fc-time").remove();
                    element.find(".fc-content").remove();
                    element.find(".fc-event-time").remove();
                    element.find(".fc-bg").remove();
                    var session_url = base_url + "/sessions/" + event.id
                    {#                    var new_description = "<div class='eventContentTitle'><h3><a href='" + session_url + ">" + event.title + "</a></h3></div>"#}
                    var new_description = "<div class='eventContentTitle'><h3><a href='javascript:void(0);' class='session-view fancybox' data-id='" + event.id + "'>" + event.title + "</a></h3></div>"
                            + "<div class='eventContentWrapper'>";

                    if (event.status == "in-queue") {

                        new_description += "<div class='eventContent'><i class='fa fa-clock-o cue'></i> <span class='attendingValue'>In Queue</span></div>";
                    }

                    else if (event.status == "yes") {
                        new_description += "<div class='eventContent'><i class='fa fa-check-circle-o attending'></i> <span class='attendingValue'>Attending</span></div>";

                    }
                    var location_url = base_url + "/locations/" + event.location_id
                    new_description += "<div class='eventContent'><i class='fa fa-clock-o'></i>"
                    new_description += "<span class='timeValue'>" + moment(event.start).format("HH:mm") + "-" + moment(event.end).format("HH:mm") + "</span></div><div class='eventContent'><i class='fa fa-map-marker'></i> <a href='" + location_url + "'><span class='locationValue'>" + event.location + "</span></a></div><div class='eventContent'>";
                    var speaker = "";
                    event.speakers.forEach(function (entry) {
                        var sepeaker_url = base_url + "/attendee-bio/" + entry.id
                        speaker += "<i class='fa fa-user'></i><span class='speakerValue'><a href='" + sepeaker_url + "'>" + entry.firstname + " " + entry.lastname + "</a>";

                    });
                    speaker += "</div>";
                    new_description += speaker;
                    if (event.taglist.length > 0) {
                        tag = "<div class='eventContent'><i class='fa fa-tag'></i> <span class='tagsValue'>";
                        event.taglist.forEach(function (entry) {
                            tag += entry + " , ";

                        });
                        tag = tag.slice(0, -2);
                        tag += "</span></div>"
                        new_description += tag;
                    }
                    {#                    console.log(event.taglist.toString(" "));#}


                    element.append(new_description);
                },
                eventAfterAllRender: function (view) {
                    var evts = $("#calendar").fullCalendar('clientEvents');
                    currentDate = view.calendar.getDate()
                    currentMinTime = view.calendar.options.minTime;
                    currentMaxTime = view.calendar.options.maxTime;
                    minTimes = []
                    maxTimes = []
                    for (var i in evts) {
                        minTime = evts[i].start.format("HH:mm:ss");
                        minTimes.push(minTime);
                        maxTime = evts[i].end.format("HH:mm:ss");
                        maxTimes.push(maxTime);
                    }
                    minTimes.sort(function (a, b) {
                        if (a < b) {
                            return -1;
                        }
                        if (a > b) {
                            return 1;
                        }
                        return 0;
                    });
                    minT = minTimes[0];
                    maxTimes.sort(function (a, b) {
                        if (a > b) {
                            return -1;
                        }
                        if (a < b) {
                            return 1;
                        }
                        return 0;
                    });
                    maxT = maxTimes[0];

                }


            };
            $('#calendar').fullCalendar(opt);
            $(".fc-scrollpane div:first-child").scrollTop(0);

        });
        function get_new() {
            {#            var csrf_token = $('input[name=csrfmiddlewaretoken]').val();#}
            var tab = "all-session";
            if ($('.my-session').hasClass('selected')) {
                tab = "my-session"

            } else {
                tab = "all-session"
            }
            $('#calendar').fullCalendar('removeEvents');
            var source1 = {
                data: {tab: 'my-session'},
                url: base_url + '/get-session-event/'

            };
            var source2 = {
                data: {tab: 'all-session'},
                url: base_url + '/get-session-event/'
            };
            if (tab == "my-session") {

                $('#calendar').fullCalendar('removeEventSource', source2)
                $('#calendar').fullCalendar('refetchEvents')
                $('#calendar').fullCalendar('addEventSource', source1);
                $('#calendar').fullCalendar('refetchEvents')
                $(".fc-widget-content .fc-scrollpane div:first-child").scrollTop(0);
            } else {
                $('#calendar').fullCalendar('removeEventSource', source1)
                $('#calendar').fullCalendar('refetchEvents')
                $('#calendar').fullCalendar('addEventSource', source2);
                $('#calendar').fullCalendar('refetchEvents')
                $(".fc-widget-content .fc-scrollpane div:first-child").scrollTop(0);
            }

        }

        $('body').on('click', '.my-session', function (e) {
            if ($('.my-session').hasClass('selected')) {

            }
            else {
                $('.all-session').removeClass('selected');
                $('.my-session').addClass('selected');
                get_new();
            }
        });
        $('body').on('click', '.all-session', function (e) {
            if ($('.all-session').hasClass('selected')) {

            }
            else {
                $('.my-session').removeClass('selected');
                $('.all-session').addClass('selected');
                get_new();
            }
        });

    </script>
    <style>

        body {
            margin: 0;
            padding: 0;
        }

        #script-warning {
            display: none;
            background: #eee;
            border-bottom: 1px solid #ddd;
            padding: 0 10px;
            line-height: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            color: red;
        }

        #loading {
            display: none;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        #calendar {
            margin: 50px auto;
        }

        .fc-event {
            cursor: pointer;
        }

        .fc-agenda-slots td div {
            height: 40px !important;
        }

        .fc-license-message {
            position: absolute;
            z-index: 99999;
            bottom: 1px;
            left: 1px;
            background: #eee;
            border-color: #ddd;
            border-style: solid;
            border-width: 1px 1px 0 0;
            padding: 2px 4px;
            font-size: 12px;
            border-top-right-radius: 3px;
        }

        .fc-event-container {
            font-size: 0.8em;
        }

        .fc-timeline-event {
            background: white !important;
            background-color: white !important;
            color: #94897A;
            box-shadow: 0px 3px 2px rgba(148, 137, 122, 0.2);
            border-radius: 0.25em;
            border-width: 2px;
            white-space: normal !important;
        }

        .fc-timeline-event:hover {
            color: #94897A;
        }

        .fc-head {
            background: none !important;
            background-color: rgba(255, 255, 255, 0);
        }

        .fc-content {
            white-space: normal !important;
        }

        .fc-widget-header * {
            background: #F3F3EB !important;
            background-color: #F3F3EB !important;
            border: none !important;
            color: #FA4092;
        }

        .fc-resource-area * {
            color: #FA4092;
        }

        .fc-widget-content div {
        }

        .fc-scrollpane-inner table. .fc-scrollpane-inner td, .fc-scrollpane-inner tr {
            border: none !important;
        }

        #calendar tr {
            border-bottom: none !important;

        }

        .eventContentTitle {
            border-bottom: 1px solid #DADAC4;
            font-size: 0.75em;
        }

        .eventContentTitle h3 {
            color: #94897A;
            padding: 0.25em !important;
        }

        .eventContentWrapper i {
            padding: 0.5em;
            color: #FF6A00;
        }

        .eventContent {
            display: inline-block;
        }

        .fc-time-area .fc-event-container {
            padding-bottom: 3px !important;
        }

        .cue {
            color: #FFC000 !important;
        }

        .attending {
            color: #00B67D !important;
        }

        .fc-event .fc-bg {
            background-color: white !important;
        }

        .fc-ltr .fc-timeline-event {
            margin: 5px;
        }

        .fc-resource-cell {
            width: 100px;
        }


    </style>

{% endblock %}