{% extends "public/layout/layout.html" %}
{% block content %}
    {% load staticfiles %}
    <link rel="stylesheet" href="{% static 'public/imagecropper/css/cropper.min.css' %}">
    <link rel="stylesheet" href="{% static 'public/css/cropper.main.css' %}">
    <style>
        .img-preview {
            max-width: 10em;
            max-height: 10em;
            border-radius: 5em;
            box-shadow: 0px 3px 2px rgba(148, 137, 122, 0.2);
            border: 2px solid #C1C19D;
        }
    </style>
    {% csrf_token %}
    <div class="wrapper">
        <div class="container padding mainContent">
            <div class="row guttes">
                <div class="col span_12">
                    <h1>FACILITATOR</h1>

                    <p>
                    <form action="{% url 'sessionExport' event_url=request.session.event_url %}" method="get"
                          id="session-export-form">
                        <button class="button round small color2">Download attendee list</button>
                    </form>
                    </p>
                </div>
            </div>
            <div class="row guttes">
                <div class="col span_6">

                    <p>
                        <label for="speakerSessions">Your sessions: </label>
                        <select id="speakerSessions" name="speakerSessions" class="sort">
                            {% for session in cntx %}
                                <option value="{{ session.session_id }}">{{ session.session_name }} </option>
                            {% endfor %}

                            <!--<option>All</option>-->
                        </select>
                    </p>
                    <p>
                        <strong>Attending: </strong><span id="total_attending"></span><br/>
                        <strong>In Queue: </strong><span id="total_cue"></span><br/>
                    </p>
                </div>
                <div class="col span_6">
                    <p>
                        <label for="sessionType">Show: </label>
                        <select id="sessionType" name="sessionType" class="sort">
                            <option value="attending">Only attending</option>
                            <option value="in-queue">Only in Queue</option>
                            <option value="both">Both attending and in Queue</option>
                        </select>
                    </p>
                </div>
            </div>
            <div class="row guttes">
                <div class="col span_12">
                </div>
            </div>

            <!-- CONTENT GOES HERE -->


            <table id="attListTbl">
                <thead>
                <tr>
                    <td>Name</td>
                    <td>Email</td>
                    <td>Office</td>
                    <td>Status</td>
                </tr>
                </thead>
                <tbody>

                </tbody>
            </table>

            <!-- Profile -->

            <input type="hidden" id="b64"/>

            <div class="row gutters">
                <div class="col span_12">
                    <h1>MY DETAILS</h1>
                </div>
            </div>
            <div class="row gutters">
                <div class="col span_6">
                    <div class="formQuestion">
                        <label>Upload profile picture</label>

                        <div class="img-container">
                            <img id="image" src="" alt=""/>

                        </div>
                        <button type="button" class="btn btn-primary btn-rotate" data-rotate="-90">
                            <span class="fa fa-rotate-left"></span>
                        </button>
                        <button type="button" class="btn btn-primary btn-rotate" data-rotate="90">
                            <span class="fa fa-rotate-right"></span>
                        </button>
                        <p>
                            <input type="file" id="inputImage" style="float:left; width: 250px" accept="image/*"/>
                        </p>
                    </div>
                </div>
                <div class="col span_6">
                    <div class="formQuestion cropped">
                        <label>Current profile picture</label><br/>

                        <div class="docs-preview clearfix">
                            <div class="img-preview preview-lg" style="display: none;"></div>
                        </div>
                        <div class="img-con">
                            {% if request.session.event_user.avatar == '' %}
                                <img id="currentProfilePicture"
                                     src="{% static 'public/images/user_no_image.png' %}"/>
                            {% else %}

                                <img id="currentProfilePicture"
                                     src="{% static request.session.event_user.avatar %}"/>

                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="row gutters">
                <div class="col span_6">
                    <div class="formQuestion">
                        <label>First name<span>As it will appear on your badge</span></label>
                        {% if first_name %}
                            <input type="text" id="bio_first_name" value="{{ first_name }}">
                        {% else %}
                            <input type="text" id="bio_first_name">
                        {% endif %}
                    </div>
                </div>
                <div class="col span_6">
                    <div class="formQuestion">
                        <label>Last name<span>As it will appear on your badge</span></label>
                        {% if last_name %}
                            <input type="text" id="bio_last_name" value="{{ last_name }}">
                        {% else %}
                            <input type="text" id="bio_last_name">
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="row gutters">
                <div class="col span_12">
                    <div class="formQuestion">
                        <label>My bio<span>Max 2 000 characters</span></label>
                        {% if bio.0 %}
                            <textarea rows="7" id="bio">{{ bio.0.value }}</textarea>
                        {% else %}
                            <textarea rows="7" id="bio"></textarea>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="row gutters">
                <div class="col span_12" style="text-align: right;">
                    <div class="formQuestion">
                        <a href="javascript:void(0);" class="button round color2 update_bio">Update</a>
                    </div>
                </div>
            </div>
            <!--row-->
            <!--row-->
            <!--row-->
        </div>
        <!-- mainContent -->
    </div><!--wrapper-->
    <div id="image-crop" class="modal fade" tabindex="-1" role="dialog" style="display: none;">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">Crop Image</h4>
                </div>
                <div class="modal-body">
                    <div class="imageBox">
                        <div class="thumbBox"></div>
                        <div class="spinner" style="display: none">Loading...</div>
                    </div>
                    <div class="action">
                        <input type="file" id="file" style="float:left; width: 250px">
                        <input type="button" id="btnCrop" value="Crop" style="float: right">
                        <input type="button" id="btnZoomIn" value="+" style="float: right">
                        <input type="button" id="btnZoomOut" value="-" style="float: right">
                    </div>
                </div>
            </div>
        </div>
    </div>


    {#    {% load staticfiles %}#}
    <script src="{% static 'public/js/croptbox.js' %}"></script>
    <script src="{% static 'public/imagecropper/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'public/js/cropper.min.js' %}"></script>
    {#    <script src="{% static 'public/js/main.js' %}"></script>#}


    <script>
        $(function () {
            $('#session-export-form').on('submit', function () {
                var session_id = $('#speakerSessions').val();
                var session_type = $('#sessionType').val();
                $('<input>').attr({
                    type: 'hidden',
                    id: 'session_id',
                    name: 'session_id',
                    value: session_id
                }).appendTo('#session-export-form');
                $('<input>').attr({
                    type: 'hidden',
                    id: 'session_type',
                    name: 'session_type',
                    value: session_type
                }).appendTo('#session-export-form');
            });
            var $image = $('#image');
            $image.cropper({
                aspectRatio: 1 / 1,
                preview: '.img-preview',
                dragMode: 'none',
                strict: true,
                guides: false,
                highlight: true,
                dragCrop: false,
                cropBoxMovable: true,
                cropBoxResizable: true,
                viewMode: 2,
                minCropBoxWidth: 100,
                minCropBoxHeight: 100,
                crop: function (e) {
                    // Output the result data for cropping image.
                    if (window.location.hostname != 'eventdobby.com') {
                        console.log(e.x);
                        console.log(e.y);
                        console.log(e.width);
                        console.log(e.height);
                        console.log(e.rotate);
                        console.log(e.scaleX);
                        console.log(e.scaleY);
                    }
                }
            });

            $('.btn-rotate').click(function () {
                $image.cropper('rotate', $(this).data('rotate'));
            });


            $('#btn-done').click(function () {
                if (window.location.hostname != 'eventdobby.com') {
                    console.log($image.cropper('getData'));
                }
            });


            var $inputImage = $('#inputImage');
            var URL = window.URL || window.webkitURL;
            var blobURL;

            if (URL) {
                $inputImage.change(function () {
                    var files = this.files;
                    var file;
                    if (!$image.data('cropper')) {
                        return;
                    }
                    if (files && files.length) {
                        file = files[0];

                        if (/^image\/\w+$/.test(file.type)) {
                            blobURL = URL.createObjectURL(file);
                            $image.one('built.cropper', function () {

                                // Revoke when load complete
                                URL.revokeObjectURL(blobURL);
                            }).cropper('reset').cropper('replace', blobURL);
                            {#                            $inputImage.val('');#}
                        } else {
                            window.alert('Please choose an image file.');
                        }
                    }
                });
            } else {
                $inputImage.prop('disabled', true).parent().addClass('disabled');
            }

        });
    </script>

    <script src="{% static 'public/js/speakerContent.js' %}"></script>

{% endblock %}

